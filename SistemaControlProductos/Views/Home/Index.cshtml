@{
        ViewBag.Title = "Dashboard - Sistema de Control";
        ViewBag.Message = "Resumen general del inventario";
}

<!--tarjetas de resumen-->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-white bg-primary">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4>@ViewBag.TotalProductos</h4>
                        <p>Total Productos</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-boxes fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-success">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4>@ViewBag.TotalCategorias</h4>
                        <p>Categorías</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-layer-group fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-warning">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4>@ViewBag.TotalProveedores</h4>
                        <p>Proveedores</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-truck fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-danger">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4>@ViewBag.StockBajo</h4>
                        <p>Stock Bajo</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-exclamation-triangle fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- desde esta seccion esta el codigo de los graficos-->
<div class="row">
    <!-- Grafico 1: productos por Categoria -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i class="fas fa-chart-pie me-2"></i>Productos por Categoría
                </h5>
            </div>
            <div class="card-body">
                <canvas id="categoriaChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>

    <!-- Grafico 2: Top Productos con Mayor Stock -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                    <i class="fas fa-chart-bar me-2"></i>Top Productos - Stock
                </h5>
            </div>
            <div class="card-body">
                <canvas id="stockChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Acciones Rapidas -->
<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">
                    <i class="fas fa-bolt me-2"></i>Acciones Rápidas
                </h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2 d-md-flex justify-content-md-start">
                    <a href="@Url.Action("Create", "Productos")" class="btn btn-success me-2">
                        <i class="fas fa-plus-circle me-1"></i> Nuevo Producto
                    </a>
                    <a href="@Url.Action("Index", "Productos")" class="btn btn-primary me-2">
                        <i class="fas fa-list me-1"></i> Ver Todos los Productos
                    </a>
                    <a href="@Url.Action("Index", "Productos")" class="btn btn-warning">
                        <i class="fas fa-exclamation-triangle me-1"></i> Ver Stock Bajo
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Scripts de los Graficos -->
@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Datos para los graficos (desde el controlador)
        var productosPorCategoria = @Html.Raw(Json.Encode(ViewBag.ProductosPorCategoria));
        var topProductos = @Html.Raw(Json.Encode(ViewBag.TopProductos));

        // Grafico pastel ( o el redondo por si se le conoce por otro nombre)- Productos por Categoria
        var ctx1 = document.getElementById('categoriaChart').getContext('2d');
        var categoriaChart = new Chart(ctx1, {
            type: 'pie',
            data: {
                labels: productosPorCategoria.map(function(item) { return item.Categoria; }),
                datasets: [{
                    data: productosPorCategoria.map(function(item) { return item.Cantidad; }),
                    backgroundColor: [
                        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
                        '#9966FF', '#FF9F40', '#FF6384', '#C9CBCF'
                    ]
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // Grafico de Barras - Top Productos por Stock
        var ctx2 = document.getElementById('stockChart').getContext('2d');
        var stockChart = new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: topProductos.map(function(item) {
                    return item.Producto.length > 15 ? item.Producto.substring(0, 15) + '...' : item.Producto;
                }),
                datasets: [{
                    label: 'Stock',
                    data: topProductos.map(function(item) { return item.Stock; }),
                    backgroundColor: '#28a745',
                    borderColor: '#1e7e34',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
}